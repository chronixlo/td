!function(e){function t(t){for(var n,l,a=t[0],o=t[1],h=t[2],c=0,f=[];c<a.length;c++)l=a[c],Object.prototype.hasOwnProperty.call(i,l)&&i[l]&&f.push(i[l][0]),i[l]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(u&&u(t);f.length;)f.shift()();return s.push.apply(s,h||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,a=1;a<r.length;a++){var o=r[a];0!==i[o]&&(n=!1)}n&&(s.splice(t--,1),e=l(l.s=r[0]))}return e}var n={},i={0:0},s=[];function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=n,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(r,n,function(t){return e[t]}.bind(null,n));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var a=window.webpackJsonp=window.webpackJsonp||[],o=a.push.bind(a);a.push=t,a=a.slice();for(var h=0;h<a.length;h++)t(a[h]);var u=o;s.push([119,1]),r()}({119:function(e,t,r){"use strict";r.r(t);r(83),r(53),r(65),r(66),r(19),r(67),r(94),r(95),r(70),r(72),r(49),r(77),r(105),r(78),r(106),r(107),r(50),r(51),r(79),r(80),r(82);var n=1,i=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=++n,this.typeId=t.typeId,this.gridX=t.gridX,this.gridY=t.gridY,this.radius=t.radius,this.lastShot=t.lastShot||0,this.shotInterval=t.shotInterval,this.projectileSpeed=t.projectileSpeed,this.projectileDamage=t.projectileDamage,this.projectileSize=t.projectileSize,this.projectileColor=t.projectileColor||"#f00",this.color=t.color||"#fff",this.size=t.size||10,this.sellPrice=Math.floor(t.price/10),this.dps=t.dps};function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t.x,this.y=t.y,this.speed=t.speed,this.size=t.size,this.health=t.health,this.lastSegment=null,this.nextSegment=null,this.lastSegmentIndex=null,this.cellOffsetX=t.cellOffsetX||.5,this.cellOffsetY=t.cellOffsetY||.5,this.money=t.money,this.color=t.color,this.accentColor=t.accentColor,this.customRender=t.render}var t,r,n;return t=e,(r=[{key:"render",value:function(e){this.customRender?this.customRender(e):(e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size))}}])&&s(t.prototype,r),n&&s(t,n),e}();function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.x=t.x,this.y=t.y,this.speed=t.speed,this.damage=t.damage,this.enemyIndex=t.enemyIndex,this.size=t.size,this.color=t.color}var t,r,n;return t=e,(r=[{key:"render",value:function(e){e.fillStyle=this.color,e.beginPath(),e.arc(this.x,this.y,this.size,0,2*Math.PI),e.fill(),e.closePath()}}])&&a(t.prototype,r),n&&a(t,n),e}(),h=(r(112),r(113),r(114),function(e,t){return Math.floor(Math.random()*(t+1-e))+e}),u=function(){return"#"+Math.floor(4096*Math.random()).toString(16).padStart(3,"0")},c=function(){return Math.random()<.5};function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,i=!1,s=void 0;try{for(var l,a=e[Symbol.iterator]();!(n=(l=a.next()).done)&&(r.push(l.value),!t||r.length!==t);n=!0);}catch(e){i=!0,s=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw s}}return r}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return y(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(r):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var m=function(e,t,r,n){var i=e[e.length-1],s=v(i).filter((function(e){var i=f(e,2),s=i[0],l=i[1];return s>=1&&s<=r&&l>=1&&l<=n&&!t.some((function(t){return g(t,e)}))}));return s[h(0,s.length-1)]},v=function(e){var t=f(e,2),r=t[0],n=t[1];return[[r-1,n],[r+1,n],[r,n-1],[r,n+1]]},g=function(e,t){return e[0]===t[0]&&e[1]===t[1]},b=(r(52),1);function S(){return new Array(6).fill().map((function(e,t){return r=10+10*t,n=h(2,8)/10,i=200+200*(1-n),l=r*(s=1+(r-10)/50)*5,a=h(2,8)/10*1,o=1e3*a,f=(c=10*s)*a,{typeId:++b,price:l,radius:1+4*n,color:u(),size:10+10*n,shotInterval:o,projectileSpeed:i,projectileDamage:f,projectileSize:3+f/3,projectileColor:u(),dps:c};var r,n,i,s,l,a,o,c,f})).sort((function(e,t){return e.price-t.price}))}var w=1,T=[null,function(e){e.fillStyle=this.color,e.fillRect(this.x,this.y,this.size,this.size),e.fillStyle=this.accentColor,e.beginPath(),e.arc(this.x+this.size/2,this.y+this.size/2,this.size/3,0,2*Math.PI),e.fill(),e.closePath()},function(e){e.fillStyle=this.color,e.beginPath(),e.arc(this.x+this.size/2,this.y+this.size/2,this.size/2,0,2*Math.PI),e.fill(),e.closePath()}];function x(){return new Array(6).fill().map((function(e,t){return n=1+((r=10*(t+1))-10)/50,i=h(2,8)/10,s=50+100*n*(1-i),l=10*Math.pow(n,4)*i,{typeId:++w,level:r,speed:s,size:10+l/10,health:l,money:r/2,color:u(),accentColor:"#fffa",render:T[h(0,T.length-1)]};var r,n,i,s,l}))}function P(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=function(e,t){if(!e)return;if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I(e,t)}(e))){var t=0,r=function(){};return{s:r,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var j=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=this.canvas=document.getElementById("game");this.ctx=this.canvas.getContext("2d"),this.gameWidth=800,this.gameHeight=450,t.height=this.gameHeight,t.width=this.gameWidth,this.gridWidth=16,this.gridHeight=9,this.cellSize=this.gameWidth/this.gridWidth,this.mouseX,this.mouseY,this.selectedTurret,this.placingTurret,this.money=100,this.wave={number:0},this.turretTypes=S(),this.enemyTypes=x(),this.turrets=[],this.projectiles=[],this.enemies=[],this.path=function(e,t,r){for(var n=0,i=[],s=[];n<50&&(n++,i.length!==r);){var l=void 0;l=c()?[1,h(1,t-2)]:[h(1,e-2),1],i.length>s.length&&(s=i),i=[l];for(var a=[];i.length!==r;){var o=m(i,a,e-2,t-2);if(!o)break;a.push.apply(a,[o].concat(d(v(i[i.length-1])))),i.push(o)}}return i.length!==r&&(i=s),i}(this.gridWidth,this.gridHeight,this.gridWidth*this.gridHeight/2),this.advance(),this.lastRender=Date.now(),t.addEventListener("mousemove",this.onMouseMove.bind(this)),t.addEventListener("mouseleave",this.onMouseLeave.bind(this)),t.addEventListener("click",this.onClick.bind(this)),this.draw=this.draw.bind(this),requestAnimationFrame(this.draw)}var t,r,n;return t=e,(r=[{key:"draw",value:function(){var e=this,t=this.ctx,r=this.gameWidth,n=this.gameHeight,i=this.cellSize,s=this.gridHeight,l=this.gridWidth;this.wave.inProgress;var a=Date.now(),h=(a-this.lastRender)/1e3;t.fillStyle="#222",t.fillRect(0,0,r,n),this.path.forEach((function(e){t.fillStyle="#aaa",t.fillRect(e[0]*i,e[1]*i,i,i)})),this.path.forEach((function(r,n){if(!(n<1||n>e.path.length-1)){var s=e.path[n-1],l=Math.min(r[0],s[0])*i+4,a=Math.max(r[0],s[0])*i-4,o=Math.min(r[1],s[1])*i+4,h=Math.max(r[1],s[1])*i-4;t.fillStyle="#666",t.fillRect(l,o,a-l+i,h-o+i)}}));var u=this.path[0][0]*i+i/2,c=this.path[0][1]*i+i/2;t.fillStyle="#8a8",t.beginPath(),t.arc(u,c,i/3,0,2*Math.PI),t.fill(),t.closePath(),t.fillStyle="#fff",t.font="20px monospace",t.textAlign="center",t.textBaseline="middle",t.fillText("s",u,c);var f=this.path[this.path.length-1][0]*i+i/2,d=this.path[this.path.length-1][1]*i+i/2;t.fillStyle="#a88",t.beginPath(),t.arc(f,d,i/3,0,2*Math.PI),t.fill(),t.closePath(),t.fillStyle="#fff",t.fillText("e",f,d),t.strokeStyle="#fffa";for(var p=0;p<=s;p++)t.beginPath(),t.moveTo(0,p*i),t.lineTo(r,p*i),t.stroke(),t.closePath();for(var y=0;y<=l;y++)t.beginPath(),t.moveTo(y*i,0),t.lineTo(y*i,n),t.stroke(),t.closePath();for(var m=function(r){var n=e.enemies[r];if(n.health<=0)return"continue";if(!n.nextSegment){var s=Math.floor(n.x/i),l=Math.floor(n.y/i),a=e.path.findIndex((function(e,t){return(null==n.lastSegmentIndex||t>n.lastSegmentIndex)&&e[0]===s&&e[1]===l})),o=e.path[a+1];n.lastSegmentIndex=a,n.lastSegment=e.path[a],n.nextSegment=o}if(!n.nextSegment)return e.wave.missed++,n.health=0,"continue";n.lastSegment[0]!==n.nextSegment[0]?e.getEnemyOffsetX(n)>n.x?(n.x+=n.speed*h,e.getEnemyOffsetX(n)<=n.x&&(n.nextSegment=null)):e.getEnemyOffsetX(n)<n.x&&(n.x-=n.speed*h,e.getEnemyOffsetX(n)>=n.x&&(n.nextSegment=null)):n.lastSegment[1]!==n.nextSegment[1]&&(e.getEnemyOffsetY(n)>n.y?(n.y+=n.speed*h,e.getEnemyOffsetY(n)<=n.y&&(n.nextSegment=null)):e.getEnemyOffsetY(n)<n.y&&(n.y-=n.speed*h,e.getEnemyOffsetY(n)>=n.y&&(n.nextSegment=null))),n.render(t)},v=this.enemies.length-1;v>-1;v--)m(v);var g,b=P(this.turrets);try{for(b.s();!(g=b.n()).done;){var S=g.value,w=S.gridX*i+i/2,T=S.gridY*i+i/2;t.fillStyle=S.color,t.beginPath(),t.arc(w,T,S.size,0,2*Math.PI),t.fill(),t.closePath();var x=S.radius*i;if(this.selectedTurret&&this.selectedTurret.id===S.id&&(t.strokeStyle=S.color,t.fillStyle=S.color+"3",t.beginPath(),t.arc(w,T,x,0,2*Math.PI),t.stroke(),t.closePath()),a-S.lastShot>S.shotInterval){var I=!1;for(var z in this.enemies){var j=this.enemies[z];I||j.health<=0||Math.hypot(w-j.x,T-j.y)<x&&(this.projectiles.push(new o({x:w,y:T,speed:S.projectileSpeed,damage:S.projectileDamage,size:S.projectileSize,enemyIndex:z,color:S.projectileColor})),S.lastShot=a,I=!0)}}}}catch(e){b.e(e)}finally{b.f()}for(var M=this.projectiles.length-1;M>-1;M--){var E=this.projectiles[M],k=this.enemies[E.enemyIndex];if(!k||k.health<=0)this.projectiles.splice(M,1);else{var O=k.x-E.x,C=k.y-E.y,A=Math.atan2(C,O),B=Math.hypot(O,C),L=Math.min(B,E.speed*h);E.x=Math.cos(A)*L+E.x,E.y=Math.sin(A)*L+E.y,Math.hypot(k.x-E.x,k.y-E.y)<E.size?(this.projectiles.splice(M,1),k.health-=E.damage,k.health<=0&&(this.wave.killed++,this.money+=k.money)):E.render(t)}}if(this.mouseX){var X=Math.floor(this.mouseX/i),Y=Math.floor(this.mouseY/i);if(t.fillStyle="rgba(255, 255, 255, 0.2)",t.fillRect(X*i,Y*i,i,i),this.placingTurret){var R=X*i+i/2,W=Y*i+i/2;t.fillStyle=this.placingTurret.color,t.beginPath(),t.arc(R,W,this.placingTurret.size,0,2*Math.PI),t.fill(),t.closePath();var D=this.placingTurret.radius*i;t.strokeStyle=this.placingTurret.color,t.beginPath(),t.arc(R,W,D,0,2*Math.PI),t.stroke(),t.closePath()}}!this.wave.finishedAt&&this.wave.total-this.wave.missed-this.wave.killed<1&&(this.wave.finishedAt=a),this.wave.finishedAt&&this.wave.finishedAt+1e3<a&&this.advance(),this.lastRender=a,requestAnimationFrame(this.draw)}},{key:"onMouseMove",value:function(e){this.mouseX=e.layerX,this.mouseY=e.layerY}},{key:"onMouseLeave",value:function(){this.mouseX=null,this.mouseY=null}},{key:"onClick",value:function(e){e.stopPropagation();var t=Math.floor(this.mouseX/this.cellSize),r=Math.floor(this.mouseY/this.cellSize);if(this.selectedTurret=null,!this.path.find((function(e){return e[0]===t&&e[1]===r}))){var n=this.turrets.find((function(e){return e.gridX===t&&e.gridY===r}));if(this.placingTurret){if(n||!(this.money>=this.placingTurret.price))return void(this.placingTurret=null);this.placingTurret.gridX=t,this.placingTurret.gridY=r,n=new i(this.placingTurret),this.money-=this.placingTurret.price,this.placingTurret=null,this.turrets.push(n)}this.selectedTurret=n}}},{key:"getEnemyOffsetX",value:function(e){return e.nextSegment[0]*this.cellSize+e.cellOffsetX*this.cellSize-.5*e.size}},{key:"getEnemyOffsetY",value:function(e){return e.nextSegment[1]*this.cellSize+e.cellOffsetY*this.cellSize-.5*e.size}},{key:"sendWave",value:function(){var e=this;if(!this.wave.inProgress){this.wave.inProgress=!0;var t=function(t){var r=e.wave.enemyTypes[t].size;setTimeout((function(){e.enemies.push(new l(Object.assign({x:e.path[0][0]*e.cellSize+e.cellSize/2-r/2,y:e.path[0][1]*e.cellSize+e.cellSize/2-r/2},e.wave.enemyTypes[t])))}),300*t)};for(var r in this.wave.enemyTypes)t(r)}}},{key:"placeTurret",value:function(e){this.placingTurret=e,this.selectedTurret=null}},{key:"advance",value:function(){this.enemies=[],this.projectiles=[];for(var e=this.wave.number+1,t=14*(10+e),r=[];t>0;){var n=this.enemyTypes.filter((function(e){return e.level<=t}));if(!n.length)break;var i=n[h(0,n.length-1)];r.push(i),t-=i.level}this.wave={number:e,total:r.length,killed:0,missed:0,inProgress:!1,finishedAt:null,enemyTypes:r}}},{key:"sellSelectedTurret",value:function(){var e=this,t=this.turrets.findIndex((function(t){return t.id===e.selectedTurret.id}));-1!==t&&(this.turrets.splice(t,1),this.money+=this.selectedTurret.sellPrice,this.selectedTurret=null)}}])&&z(t.prototype,r),n&&z(t,n),e}());r(118);function M(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toolbar=document.getElementById("toolbar"),this.turrets=document.getElementById("turrets"),this.readyButton=document.getElementById("ready-button"),this.waveNumber=document.getElementById("wave-number"),this.money=document.getElementById("money"),this.turretInfo=document.getElementById("turret-info"),this.sellTurret=document.getElementById("sell-turret"),this.turretButtons=[],this.turretButtonSize=70,this.lastValues={},this.init(),this.render=this.render.bind(this),requestAnimationFrame(this.render)}var t,r,n;return t=e,(r=[{key:"init",value:function(){var e=this;j.turretTypes.forEach((function(t){var r=document.createElement("div");r.classList.add("button","turret-button"),r.addEventListener("click",(function(e){e.stopPropagation(),j.placeTurret(t)})),r.addEventListener("mouseenter",(function(){e.showTurretInfo=t})),r.addEventListener("mouseleave",(function(){e.showTurretInfo=null})),e.turrets.appendChild(r);var n=document.createElement("canvas");r.appendChild(n),n.width=n.height=e.turretButtonSize;var i=n.getContext("2d");i.fillStyle=t.color,i.beginPath(),i.arc(e.turretButtonSize/2,e.turretButtonSize/2,t.size,0,2*Math.PI),i.fill(),i.closePath(),i.fillStyle=t.projectileColor,i.beginPath(),i.arc(e.turretButtonSize/2+t.size+t.projectileSize/2,e.turretButtonSize/2-t.size-t.projectileSize/2,t.projectileSize,0,2*Math.PI),i.fill(),i.closePath();var s=document.createElement("span");s.classList.add("price-label"),s.textContent="$ "+t.price,r.appendChild(s),e.turretButtons.push({turret:t,element:r})})),this.readyButton.addEventListener("click",(function(e){e.stopPropagation(),j.sendWave(),j.placeTurret(null)})),this.sellTurret.addEventListener("click",(function(e){e.stopPropagation(),j.sellSelectedTurret()})),document.addEventListener("click",(function(){j.placeTurret(null)}))}},{key:"render",value:function(){var e=this;this.callOrder=0,this.onChange([j.wave.inProgress],(function(){j.wave.inProgress?e.readyButton.classList.add("disabled"):e.readyButton.classList.remove("disabled")})),this.onChange([j.wave.number],(function(){e.waveNumber.textContent="Wave "+j.wave.number})),this.onChange([j.money,this.turretButtons.length],(function(){e.money.textContent="$ "+j.money,e.turretButtons.forEach((function(e){e.turret.price>j.money?e.element.classList.add("disabled"):e.element.classList.remove("disabled")}))})),this.onChange([j.selectedTurret&&j.selectedTurret.id,j.placingTurret&&j.placingTurret.typeId],(function(){var t=j.selectedTurret||j.placingTurret;if(t)return e.turretInfo.textContent=["dps","radius","shotInterval","projectileSpeed","projectileDamage"].map((function(e){return e+": "+Math.round(t[e])})).join("\n"),void(j.selectedTurret?(e.sellTurret.textContent="Sell $ ".concat(t.sellPrice),e.sellTurret.classList.add("visible")):e.sellTurret.classList.remove("visible"));e.sellTurret.classList.remove("visible"),e.turretInfo.textContent=""})),this.onChange([j.placingTurret&&j.placingTurret.typeId],(function(){e.turretButtons.forEach((function(e){j.placingTurret&&j.placingTurret.typeId===e.turret.typeId?e.element.classList.add("selected"):e.element.classList.remove("selected")}))})),requestAnimationFrame(this.render)}},{key:"onChange",value:function(e,t){var r=this.callOrder++;for(var n in e)if(!this.lastValues[r]||this.lastValues[r][n]!==e[n]){t();break}this.lastValues[r]=e}}])&&M(t.prototype,r),n&&M(t,n),e}())},83:function(e,t,r){}});
//# sourceMappingURL=app.5c554478.js.map